<%- include('common/view_start', {
  title: 'Advisor',
  cssFiles: ['advisor'],
  navBarLocation: 'advisor'
}) %>

  <%- include('common/header', {
  heading: 'Advisor',
  subheading: 'อาจารย์ที่ปรึกษา',
  breadcrumb: [
    'Advisor'
  ]
}) %>

    <div class="container">

      <div class="row">
        <div class="col-xs-12 col-md-12">
          <h3>ข้อมูลอาจารย์ที่ปรึกษา</h3>
          <p><%= user.display_name %></p>
        </div>
      </div>

      <hr>

      <div class="row">
        <div class="col-xs-12 col-md-5">
          <table class="table" id="summary_table">
            <h3>สถานะนิสิตทั้งหมด</h3>
            <thead>
              <tr>
                <th>ชั้นปั</th>
                <th>จำนวน</th>
                <th>ติดโปรต่ำ</th>
                <th>ติดโปรสูง</th>
                <th>ไม่เรียนในเทอมนี้</th>
              </tr>
            </thead>
            <tbody class="year_label">
            </tbody>
          </table>
        </div>

        <div class="col-xs-12 col-md-7">
          <ul class="nav nav-tabs" role="tablist" id="myTab">
            <li role="presentation" class="active"><a href="#graph-all" aria-controls="graph-all" role="tab" data-toggle="tab">นิสิตทั้งหมด</a></li>
            <li role="presentation"><a href="#graph-st1" aria-controls="graph-st1" role="tab" data-toggle="tab">ติดโปรต่ำ</a></li>
            <li role="presentation"><a href="#graph-st2" aria-controls="graph-st2" role="tab" data-toggle="tab">ติดโปรสูง</a></li>
            <li role="presentation"><a href="#graph-st3" aria-controls="graph-st3" role="tab" data-toggle="tab">ไม่เรียนในเทอมนี้</a></li>
          </ul>
          <canvas id="nisit-chart"></canvas>
        </div>
      </div>

      <hr>

      <div class="row">
        <div class="col-xs-12">
          <table class="table">
            <h3>นิสิตในความดูแล</h3>
            <thead>
              <tr>
                <th>#</th>
                <th>รหัสนิสิต</th>
                <th>ชื่อ</th>
                <th>ชั้นปี</th>
                <th>คณะ</th>
                <th>ภาควิชา</th>
                <th>สาขา</th>
                <th>GPAX</th>
                <th>คะแนนความประพฤติ</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% for (let i = 0; i < tab1.length; i++) { %>
                <tr>
                  <th scope="row"><%= i + 1 %></th>
                  <td><%= tab1[i].sid %></td></td>
                  <td><%= tab1[i].fname_th + ' ' + tab1[i].lname_th %></td>
                  <td><%= new Date().getFullYear() - tab1[i].ent_year + Math.floor(new Date().getMonth()/12 + 4/12) %></td>
                  <td><%= tab1[i].f_name %></td>
                  <td><%= tab1[i].d_name %></td>
                  <td><%= tab1[i].m_name %></td>
                  <td><%= (Math.pow(Math.random()*9,1/2) + 1).toFixed(2) %></td>
                  <td>
                    <div class="progress" style="margin-bottom: 1px">
                      <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:<%= tab1[i].behav_score %>%;"></div>
                    </div>
                  </td>
                  <td><%= tab1[i].behav_score %></td>
                </tr>
              <% } %>
            </tbody>
          </table>
          <p><b>ทั้งหมด:</b> <%= total1 %> คน</p>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-12">
          <table class="table">
            <h3>นิสิตที่ไม่สามารถมาเรียนได้</h3>
            <thead>
              <tr>
                <th>#</th>
                <th>รหัสนิสิต</th>
                <th>ชื่อ</th>
                <th>ชัั้นปี</th>
                <th>ตั้งแต่</th>
                <th>ถึงวันที่</th>
                <th>สาเหตุ</th>
              </tr>
            </thead>
            <tbody>
              <% for (let i = 0; i < tab2.length; i++) { %>
                <tr>
                  <th scope="row"><%= i + 1 %></th>
                  <td><%= tab2[i].sid %></td></td>
                  <td><%= tab2[i].fname_th + ' ' + tab2[i].lname_th %></td>
                  <td><%= new Date().getFullYear() - tab2[i].ent_year + Math.floor(new Date().getMonth()/12 + 4/12) %></td>
                  <td><%= moment(tab2[i].start_date).locale('th').format('LL') %></td>
                  <td><%= moment(tab2[i].end_date).locale('th').format('LL') %></td>
                  <td><div data-toggle="tooltip" title="<%= tab2[i].description %>" style="color: #e25041"> <%= tab2[i].cause %> </div></td>
                </tr>
              <% } %>
            </tbody>
          </table>
          <p><b>ทั้งหมด:</b> <%= total2 %> คน</p>
        </div>
      </div>
    </div>

    <script>
      var y1 = <%- JSON.stringify(y1) %>;
      var y2 = <%- JSON.stringify(y2) %>;
      var y3 = <%- JSON.stringify(y3) %>;
      var y4 = <%- JSON.stringify(y4) %>;
      var y5 = <%- JSON.stringify(y5) %>;
    </script>

    <%- include('common/view_end', {
  jsFiles: ['advisor']
}) %>